<view class="page" wx:if="{{isInitialized}}">

<!-- 进度条 -->
<view class="progress-bar">
  <view class="progress-inner" style="width: {{progress}}%"></view>
</view>

<!-- 题号显示 -->
<view class="question-index">
  {{currentQuestion + 1}} / {{totalQuestions}}
</view>

<!-- 当前题目 -->
<block wx:if="{{questions[currentQuestion]}}">
  <view class="question-title">
    {{questions[currentQuestion].title}}
    <text wx:if="{{questions[currentQuestion].required}}" class="required">*</text>
  </view>

  <!-- 单选题 -->
  <radio-group wx:if="{{questions[currentQuestion].type === 'single'}}">
    <view wx:for="{{questions[currentQuestion].options}}" wx:key="value" class="option-item"
          bindtap="onSingleSelect"
          data-qid="{{questions[currentQuestion].id}}"
          data-value="{{item.value}}">
      <radio checked="{{isSingleChecked(questions[currentQuestion].id, item.value)}}" />
      <text>{{item.label}}</text>
    </view>
  </radio-group>

  <!-- 多选题 -->
  <checkbox-group wx:if="{{questions[currentQuestion].type === 'multiple'}}">
    <view wx:for="{{questions[currentQuestion].options}}" wx:key="value" class="option-item"
          bindtap="onMultiToggle"
          data-qid="{{questions[currentQuestion].id}}"
          data-value="{{item.value}}">
      <checkbox checked="{{isMultiChecked(questions[currentQuestion].id, item.value)}}" />
      <text>{{item.label}}</text>
    </view>
  </checkbox-group>
</block>

<!-- 底部按钮 -->
<view class="btn-area">
  <button class="btn-light" bindtap="goBack">上一题</button>
  <button class="btn-primary" bindtap="nextQuestion">
    {{currentQuestion >= totalQuestions - 1 ? "提交诊断" : "下一题"}}
  </button>
</view>

</view>

<view wx:else class="loading">问卷加载中...</view>
